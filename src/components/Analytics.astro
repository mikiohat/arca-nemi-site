---
/**
 * 本番ビルド時のみ GA を読み込む
 * 条件A: import.meta.env.PROD
 * 条件B: location.hostname === OFFICIAL_HOST
 */
import { IS_PROD, GA_ID, OFFICIAL_HOST, ALLOWED_HOSTS } from "../consts";

console.log("[SRV] IS_PROD:", IS_PROD); // ← devだと false
console.log("[SRV] GA_ID:", GA_ID || "(empty)"); // ← devでは空のこと多い
console.log("[SRV] OFFICIAL_HOST:", OFFICIAL_HOST);
console.log("[SRV] ALLOWED_HOSTS:", ALLOWED_HOSTS);
console.log("[SRV] MODE:", import.meta.env.MODE); // development / production
---

<script>
  import { IS_PROD, GA_ID, OFFICIAL_HOST, ALLOWED_HOSTS } from "../consts";
  console.log("IS_PROD:", IS_PROD);
  console.log("GA_ID:", GA_ID || "(empty)"); // ← devでは空のこと多い
  console.log("OFFICIAL_HOST:", OFFICIAL_HOST);
  console.log("ALLOWED_HOSTS:", ALLOWED_HOSTS);
  console.log("hostname:", location.hostname);
  console.log("mode:", import.meta.env.MODE);
</script>


{IS_PROD && (
  <script is:inline>
    (function(){
      const allowedHosts = ["arca-nemi.dev", "vercel.app"];
      const host = location.hostname;
      const allowed = allowedHosts.some(h => host.includes(h));
      // var HOST = "{ ALLOWED_HOSTS }";
      if (!allowed) { console.log("[GTM] skipped (host mismatch)"); return; }
      // Google Tag Manager
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
        var f=d.getElementsByTagName(s)[0], j=d.createElement(s), dl=l!='dataLayer'?'&l='+l:'';
        j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
        f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-PZDTGPSS');
      // End Google Tag Manager
    })();
  </script>
)}

