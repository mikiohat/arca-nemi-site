---
/**
 * 本番ビルド時のみ GA を読み込む
 * 条件A: import.meta.env.PROD
 * 条件B: location.hostname === OFFICIAL_HOST
 */
import { IS_PROD, GA_ID, OFFICIAL_HOST, ALLOWED_HOSTS } from "../consts";

console.log("[SRV] IS_PROD:", IS_PROD); // ← devだと false
console.log("[SRV] GA_ID:", GA_ID || "(empty)"); // ← devでは空のこと多い
console.log("[SRV] OFFICIAL_HOST:", OFFICIAL_HOST);
console.log("[SRV] ALLOWED_HOST:", ALLOWED_HOSTS);
console.log("[SRV] MODE:", import.meta.env.MODE); // development / production
---

<script>
  import { IS_PROD, GA_ID, OFFICIAL_HOST } from "../consts";
  console.log("IS_PROD:", IS_PROD);
  console.log("GA_ID:", GA_ID || "(empty)"); // ← devでは空のこと多い
  console.log("OFFICIAL_HOST:", OFFICIAL_HOST);
  console.log("hostname:", location.hostname);
  console.log("mode:", import.meta.env.MODE);
</script>


{IS_PROD && (
  <script is:inline data-host={ALLOWED_HOSTS}>
    (function(){
      var el   = document.currentScript;
      var HOSTS = el && el.dataset ? el.dataset.host : ""; 
      const allowed = HOSTS.some(h => location.hostname.includes(h));
      console.log("[FUN] HOST:", HOSTS);
      console.log("[FUN] ALLOWED:", allowed);            
      if (location.hostname !== HOST) { console.log("[GTM] skipped (host mismatch)"); return; }
      // Google Tag Manager
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
        var f=d.getElementsByTagName(s)[0], j=d.createElement(s), dl=l!='dataLayer'?'&l='+l:'';
        j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
        f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-PZDTGPSS');
      // End Google Tag Manager
    })();
  </script>
)}

<!-- 
  <script is:inline data-ga={GA_ID} data-host={OFFICIAL_HOST}>
    (function () {
      var el   = document.currentScript;
      var GAID = el && el.dataset ? el.dataset.ga   : "";
      var HOST = el && el.dataset ? el.dataset.host : ""; -->
