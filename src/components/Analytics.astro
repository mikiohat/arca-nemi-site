---
/**
 * 本番ビルド時のみ GTM を読み込む
 * 条件: location.hostname === OFFICIAL_HOST
 */
import { OFFICIAL_HOST, GTM_ID } from "../consts";

//console.log("[SRV] OFFICIAL_HOST:", OFFICIAL_HOST);
---

<!-- defer は基本的に<script src="..."></script>で効く。↓はinlineで、Baselayoutでheadに読み込まれて展開だからたぶん意味なし-->
<script is:inline data-ga={GTM_ID} data-host={OFFICIAL_HOST} defer>
  (function () {
    var el = document.currentScript;
    var GTMID = el && el.dataset ? el.dataset.ga : "";
    var HOST = el && el.dataset ? el.dataset.host : "";
    if (location.hostname !== HOST) {
      console.log("[GTM] skipped (host mismatch)");
      return;
    }
    // Google Tag Manager
    (function (w, d, s, l, i) {
      w[l] = w[l] || [];
      w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
      var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != "dataLayer" ? "&l=" + l : "";
      j.async = true;
      j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
      f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", GTMID);
    // End Google Tag Manager
  })();
</script>
